<!DOCTYPE html>
<html lang="pt">
<head>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>OndeCortar.pt | Barbearias em Portugal + Loja com Produtos para Barba</title>
  <meta name="description" content="Encontre barbearias em Portugal com mapa e contactos. Explore a nossa loja com m√°quinas de cortar cabelo, kits de barba e acess√≥rios com envio para Portugal.">
  <meta name="keywords" content="barbearia Portugal, onde cortar cabelo, barbeiro perto de mim, ondecortar" />

  <meta property="og:title" content="OndeCortar.pt - Encontre Barbeiros em Portugal R√°pido e Gr√°tis" />
  <meta property="og:description" content="Barbeiros locais com contactos, localiza√ß√£o e mapa. Sem custos, sem confus√µes. Simples." />
  <meta property="og:url" content="https://ondecortar.pt/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://ondecortar.pt/imagem_preview.png" />
  <meta name="theme-color" content="#111111" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Fonte de dados -->
  <script src="Barbeiros/barbeiros.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
    }
    header {
      background-color: #111;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    .search-box {
      max-width: 680px;
      margin: 1rem auto 0.25rem auto;
      display: flex;
      gap: .5rem;
      align-items: center;
      justify-content: center;
      flex-wrap: nowrap;
    }
    .search-box input {
      flex-grow: 1;
      min-width: 220px;
      padding: 0.65rem 0.75rem;
      border-radius: .5rem;
      border: 1px solid rgba(255,255,255,.2);
    }
    .search-box button {
      padding: 0.65rem 1rem;
      border-radius: .5rem;
      white-space: nowrap;
    }
    .search-meta {
      max-width: 680px;
      margin: .5rem auto 0 auto;
      color: rgba(255,255,255,.85);
      font-size: .95rem;
    }

    .map-container {
      height: 70vh;
      min-height: 420px;
    }

    .cta {
      background-color: #eafbee;
      text-align: center;
      padding: 2rem;
    }
    .cta h2 { color: #000; }

    footer {
      background-color: #111;
      color: white;
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
    }
    footer a { color: #fff; opacity: .9; }
    footer a:hover { opacity: 1; }

    .popup-card {
      max-width: 260px;
      font-size: 0.92rem;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    .popup-card strong { font-size: 1rem; }
    .popup-card a {
      color: #0d6efd;
      text-decoration: none;
      word-break: break-word;
    }

    #sobreModal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }
    #sobreModalContent {
      background: #fff;
      color: #000;
      padding: 2rem;
      border-radius: 12px;
      max-width: 680px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
    }
    #sobreModalContent .btn {
      background-color: #fff;
      border: 1px solid #ccc;
      color: #000;
    }

    .sr-only {
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      border:0;
    }

    @media (max-width: 520px) {
      .search-box { flex-wrap: wrap; }
      .search-box input { width: 100%; }
      .search-box button { width: 49%; }
    }
  </style>

  <!-- SEO Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://ondecortar.pt/#website",
        "url": "https://ondecortar.pt/",
        "name": "OndeCortar.pt",
        "description": "Encontre barbearias em Portugal com mapa, contactos e links diretos. Descubra tamb√©m a nossa loja de produtos para barbearia com envio da Amazon Espanha.",
        "publisher": {
          "@type": "Organization",
          "name": "OndeCortar.pt"
        },
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://ondecortar.pt/?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      }
    ]
  }
  </script>
</head>

<body>

<header>
  <h1 class="mb-2"><strong>OndeCortar.pt</strong></h1>
  <p class="mb-3">Descobre barbeiros perto de ti ‚Äì f√°cil, r√°pido e gratuito</p>

  <div class="search-box" role="search" aria-label="Pesquisar barbearias">
    <label for="searchInput" class="sr-only">Pesquisar barbearias</label>
    <input type="text" id="searchInput" placeholder="Ex: Guimar√£es, Porto, Braga, 'Barbearia do Z√©'..." autocomplete="off" />
    <button class="btn btn-danger" id="searchBtn" type="button" aria-label="Pesquisar">Pesquisar</button>
    <button class="btn btn-outline-light" id="clearBtn" type="button" aria-label="Limpar pesquisa">Limpar</button>
  </div>

  <div class="search-meta">
    <span id="resultsInfo">A carregar barbearias‚Ä¶</span>
  </div>

  <div class="mt-4">
    <a href="loja.html" class="btn btn-warning fw-bold" style="font-size: 1.05rem;">
      üõí Visita a nossa Loja de Barbearia
    </a>
  </div>
</header>

<noscript>
  <div class="alert alert-warning m-3">
    Para usar o mapa, ativa o JavaScript no teu navegador.
  </div>
</noscript>

<div id="map" class="map-container"></div>

<section class="cta">
  <h2>√âs barbeiro?</h2>
  <p>Adiciona o teu espa√ßo gratuitamente e come√ßa a receber novos clientes hoje mesmo.</p>
  <a href="registar.html" class="btn btn-danger">Quero aparecer no OndeCortar.pt</a>
</section>

<!-- Modal Sobre o Site -->
<div id="sobreModal" role="dialog" aria-modal="true" aria-labelledby="sobreTitle">
  <div id="sobreModalContent">
    <h5 id="sobreTitle">Sobre o OndeCortar.pt</h5>
    <p>OndeCortar.pt √© uma plataforma independente que ajuda pessoas a encontrarem barbearias em Portugal de forma r√°pida e visual.</p>
    <p>Parte das informa√ß√µes pode ter sido recolhida de fontes p√∫blicas dispon√≠veis online.</p>
    <p>Se desejares <strong>adicionar, atualizar ou remover</strong> a tua barbearia, envia email para:
      <a href="mailto:contacto@ondecortar.pt">contacto@ondecortar.pt</a>.
    </p>
    <p class="mb-0">Obrigado por fazeres parte da rede de barbearias em Portugal!</p>
    <div class="text-end mt-3">
      <button class="btn" id="closeAboutBtn" type="button">Fechar</button>
    </div>
  </div>
</div>

<section class="text-center my-5 px-3">
  <h2 style="font-size: 1.5rem; font-weight: bold;">Barbearias por todo o pa√≠s</h2>
  <p>Encontra barbeiros em <strong>Lisboa</strong>, <strong>Porto</strong>, <strong>Braga</strong>, <strong>Faro</strong> e outras cidades ‚Äî com contactos, morada e site no mapa interativo.</p>

  <h3 style="font-size: 1.2rem; font-weight: bold; margin-top: 2rem;">Produtos de barbearia com entrega em Portugal</h3>
  <p>Selecion√°mos <strong>m√°quinas de cortar cabelo</strong>, <strong>kits de barba</strong>, <strong>navalhas</strong> e <strong>acess√≥rios</strong> com envio r√°pido pela Amazon Espanha. Visita a nossa <a href="loja.html">loja de produtos de barbearia</a>.</p>
</section>

<footer>
  <p>¬© 2026 OndeCortar.pt | Feito com ‚ù§Ô∏è em Portugal</p>
  <p><a href="faq.html">Perguntas Frequentes</a> | <a href="#" id="aboutLink">Sobre o site</a></p>
</footer>

<script>
  // ---------- Utilit√°rios de seguran√ßa ----------
  function escapeHtml(str) {
    return String(str ?? '')
      .replaceAll('&', '&amp;')
      .replaceAll('<', '&lt;')
      .replaceAll('>', '&gt;')
      .replaceAll('"', '&quot;')
      .replaceAll("'", '&#039;');
  }

  function safeUrl(url) {
    const u = String(url ?? '').trim();
    if (!u) return '';
    if (u.startsWith('http://') || u.startsWith('https://')) return u;
    return '';
  }

  function normalizar(texto) {
    return String(texto ?? '')
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '')
      .toLowerCase()
      .trim();
  }

  function validCoords(coords) {
    return Array.isArray(coords)
      && coords.length === 2
      && typeof coords[0] === 'number'
      && typeof coords[1] === 'number'
      && isFinite(coords[0]) && isFinite(coords[1])
      && Math.abs(coords[0]) <= 90
      && Math.abs(coords[1]) <= 180;
  }

  function setResultsInfo(text) {
    const el = document.getElementById('resultsInfo');
    if (el) el.textContent = text;
  }

  // Importante: N√ÉO dependemos de window.barbearias.
  // Esperamos pela vari√°vel global "barbearias" existir (mesmo que venha de const/let/var no ficheiro).
  function waitForBarbearias(maxMs = 1500, stepMs = 50) {
    return new Promise((resolve) => {
      const started = Date.now();
      const timer = setInterval(() => {
        const ok = (typeof barbearias !== 'undefined') && Array.isArray(barbearias);
        if (ok) {
          clearInterval(timer);
          resolve(true);
        } else if (Date.now() - started > maxMs) {
          clearInterval(timer);
          resolve(false);
        }
      }, stepMs);
    });
  }

  function debounce(fn, delay) {
    let timer;
    return (...args) => {
      clearTimeout(timer);
      timer = setTimeout(() => fn(...args), delay);
    };
  }

  document.addEventListener('DOMContentLoaded', async () => {
    // ---------- Mapa ----------
    const map = L.map('map').setView([39.5, -8.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    function adicionarMarcadores(lista) {
      markers.forEach(m => map.removeLayer(m));
      markers = [];

      const bounds = [];

      lista.forEach(b => {
        const nome = escapeHtml(b.name || b.nome || 'Barbearia');
        const morada = escapeHtml(b.morada || '');
        const telefone = escapeHtml(b.telefone || '');
        const website = safeUrl(b.website || '');
        const email = String(b.email || '').trim();

        const coords = b.coords;
        if (!validCoords(coords)) return;

        const popupContent = `
          <div class="popup-card">
            <strong>${nome}</strong><br>
            ${morada ? `üìç ${morada}<br>` : ''}
            ${telefone ? `üìû ${telefone}<br>` : ''}
            ${website ? `üåê <a href="${website}" target="_blank" rel="noopener noreferrer">${escapeHtml(website)}</a><br>` : ''}
            ${email ? `‚úâÔ∏è <a href="mailto:${encodeURIComponent(email)}">${escapeHtml(email)}</a>` : ''}
          </div>
        `;

        const marker = L.marker(coords).addTo(map).bindPopup(popupContent);
        markers.push(marker);
        bounds.push(coords);
      });

      if (bounds.length > 0) {
        map.fitBounds(L.latLngBounds(bounds), { padding: [30, 30] });
      }
    }

    function filtrarBarbearias(termo) {
      const t = normalizar(termo);
      if (!t || t.length < 2) return barbearias;

      return barbearias.filter(b => {
        const nome = normalizar(b.name || b.nome || '');
        const morada = normalizar(b.morada || '');
        return nome.includes(t) || morada.includes(t);
      });
    }

    function buscarBarbearia() {
      if (typeof barbearias === 'undefined' || !Array.isArray(barbearias)) {
        setResultsInfo('N√£o foi poss√≠vel carregar as barbearias. Tenta novamente mais tarde.');
        console.error('Dados n√£o carregaram: verifica se Barbeiros/barbeiros.js est√° acess√≠vel e sem erros.');
        return;
      }

      const termo = document.getElementById("searchInput").value;
      const filtradas = filtrarBarbearias(termo);

      adicionarMarcadores(filtradas);

      if (normalizar(termo).length < 2) {
        setResultsInfo(`A mostrar ${filtradas.length} barbearias (todas).`);
      } else if (filtradas.length === 0) {
        setResultsInfo('Sem resultados. Tenta uma cidade (ex.: Braga) ou parte do nome.');
        map.setView([39.5, -8.0], 6);
      } else {
        setResultsInfo(`A mostrar ${filtradas.length} resultado(s) para ‚Äú${termo.trim()}‚Äù.`);
      }
    }

    const buscarDebounced = debounce(buscarBarbearia, 250);

    // ---------- Modal Sobre ----------
    function abrirSobre() { document.getElementById("sobreModal").style.display = "flex"; }
    function fecharSobre() { document.getElementById("sobreModal").style.display = "none"; }

    // ---------- Eventos ----------
    document.getElementById('searchBtn').addEventListener('click', buscarBarbearia);
    document.getElementById('clearBtn').addEventListener('click', () => {
      document.getElementById('searchInput').value = '';
      buscarBarbearia();
      document.getElementById('searchInput').focus();
    });

    document.getElementById('searchInput').addEventListener('input', buscarDebounced);
    document.getElementById('searchInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        buscarBarbearia();
      }
    });

    document.getElementById('aboutLink').addEventListener('click', (e) => {
      e.preventDefault();
      abrirSobre();
    });
    document.getElementById('closeAboutBtn').addEventListener('click', fecharSobre);
    document.getElementById('sobreModal').addEventListener('click', (e) => {
      if (e.target.id === 'sobreModal') fecharSobre();
    });

    // ---------- Boot ----------
    setResultsInfo('A carregar barbearias‚Ä¶');

    const ok = await waitForBarbearias();
    if (!ok) {
      setResultsInfo('N√£o foi poss√≠vel carregar as barbearias. Tenta novamente mais tarde.');
      console.error('Timeout a carregar barbearias. Verifica caminho/capitaliza√ß√£o: Barbeiros/barbeiros.js');
      return;
    }

    // Ler query ?q=... (partilha/SEO)
    const params = new URLSearchParams(window.location.search);
    const q = params.get('q');
    if (q) document.getElementById('searchInput').value = q;

    // Mostrar mapa logo
    setResultsInfo(`A mostrar ${barbearias.length} barbearias (todas).`);
    buscarBarbearia();
  });
</script>

</body>
</html>
